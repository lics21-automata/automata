<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Example_Sufficient</title>
</head>


<body>
<div class="head">
<h1>Theory Example_Sufficient</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Example_Sufficient
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Sufficient.html">Sufficient</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Example 13 *)</span>

<span class="comment1">(* states *)</span>

<span class="keyword1"><span class="command">datatype</span></span> states <span class="main">=</span> q0 <span class="main">|</span> q1 <span class="main">|</span> q2 <span class="main">|</span> q3

<span class="keyword1"><span class="command">instantiation</span></span> states <span class="main">::</span> <span class="quoted">finite</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> states set<span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>q0<span class="main">,</span> q1<span class="main">,</span> q2<span class="main">,</span> q3<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> states.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> states set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* alphabet *)</span>

<span class="keyword1"><span class="command">datatype</span></span> Sigma <span class="main">=</span> a <span class="main">|</span> b

<span class="keyword1"><span class="command">instantiation</span></span> Sigma <span class="main">::</span> <span class="quoted">finite</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> Sigma set<span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>a<span class="main">,</span> b<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sigma.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> Sigma set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* Figure 2a *)</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"states <span class="main">⇒</span> Sigma <span class="main">⇒</span> states <span class="main">×</span> Sigma list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delta</span> q0 a <span class="main">(</span>q1<span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> q0 a <span class="main">(</span>q2<span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> q0 a <span class="main">(</span>q3<span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> q1 a <span class="main">(</span>q0<span class="main">,</span> <span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> q1 a <span class="main">(</span>q0<span class="main">,</span> <span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> q2 a <span class="main">(</span>q0<span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> q3 b <span class="main">(</span>q0<span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> delta <span class="free">q</span> <span class="free">z</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> delta <span class="free">q</span> <span class="free">z</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> UNIV <span class="main">×</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">≤</span> <span class="numeral">4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset finite_bounded_lists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* NFT well-defined *)</span>

<span class="keyword1"><span class="command">interpretation</span></span> NFT <span class="quoted">q0</span> <span class="quoted">delta</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">=</span> q0"</span></span> <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">using</span></span> finite_UNIV finite_delta
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_q0_qf<span class="main">:</span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> a<span class="main">]</span><span class="main">)</span> q0"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_q1_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"computation q1 <span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">q'</span> <span class="main">=</span> q1<span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> <span class="free">q'</span> <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> a <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> b <span class="main">#</span> a <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> <span class="free">q'</span> <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> a <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> computation.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_q2_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"computation q2 <span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">q'</span> <span class="main">=</span> q2<span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> <span class="free">q'</span> <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> a <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> computation.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_q3_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"computation q3 <span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">q'</span> <span class="main">=</span> q3<span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> <span class="free">q'</span> <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> b <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> a <span class="main">#</span> a <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> computation.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_q0_q0_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> q0 <span class="main">⟹</span> <span class="main">(</span><span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> q0 <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> a <span class="main">#</span> a <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> q0 <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> a <span class="main">#</span> a <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span> <span class="bound">bs'</span><span class="main">.</span> computation q0 <span class="main">(</span><span class="bound">zs'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> q0 <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> <span class="bound">zs'</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> a <span class="main">#</span> <span class="bound">bs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> computation.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> comp_q1_dest comp_q2_dest comp_q3_dest<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> a<span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">app_ls</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">×</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">×</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">×</span> <span class="tfree">'b</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_ls</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ys'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">xs'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ys'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Sigma list <span class="main">×</span> Sigma list<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Tstar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Sigma list <span class="main">×</span> Sigma list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Tstar</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">Tstar</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟹</span> <span class="free">Tstar</span> <span class="main">(</span>app_ls <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lang<span class="main">:</span> <span class="quoted"><span class="quoted">"τ <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Tstar T <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> τ"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">as</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="skolem">as</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">)</span> q0"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lassm
    <span class="keyword1"><span class="command">unfolding</span></span> τ_def x_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> x_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">as</span></span> <span class="quoted"><span class="skolem">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as'</span> <span class="bound">bs'</span><span class="main">.</span> length <span class="bound">as'</span> <span class="main">&lt;</span> length <span class="skolem">as</span> <span class="main">⟹</span> computation q0 <span class="main">(</span><span class="bound">as'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span> q0 <span class="main">⟹</span>
      Tstar T <span class="main">(</span><span class="bound">as'</span><span class="main">,</span> <span class="bound">bs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as'</span> <span class="skolem">bs'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span> q0"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> a <span class="main">#</span> a <span class="main">#</span> <span class="skolem">as'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> <span class="skolem">bs'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> T"</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="main">(</span>a <span class="main">#</span> a <span class="main">#</span> <span class="skolem">as'</span><span class="main">,</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Tstar.intros<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as'</span> <span class="skolem">bs'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span> q0"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> a <span class="main">#</span> a <span class="main">#</span> <span class="skolem">as'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> <span class="skolem">bs'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> T"</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="main">(</span>a <span class="main">#</span> a <span class="main">#</span> <span class="skolem">as'</span><span class="main">,</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Tstar.intros<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as'</span> <span class="skolem">bs'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span> q0"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> <span class="skolem">as'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> a <span class="main">#</span> <span class="skolem">bs'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> a<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> T"</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="main">(</span>a <span class="main">#</span> b <span class="main">#</span> <span class="skolem">as'</span><span class="main">,</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> b <span class="main">#</span> a <span class="main">#</span> a <span class="main">#</span> <span class="skolem">bs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Tstar.intros<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_q0_q0_dest<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Tstar.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Tstar T <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Tstar T <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tstar T <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> τ"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Tstar.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="skolem">x</span> q0"</span></span>
      <span class="keyword1"><span class="command">using</span></span> computation.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> computation.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span>
          <span class="operator">OF</span> computation.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        computation.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> computation.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span>
          <span class="operator">OF</span> computation.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        computation.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> computation.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span>
          <span class="operator">OF</span> computation.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> τ_def comp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> τ_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> active_q1_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"active q1 <span class="free">bs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bs'</span> <span class="bound">bs''</span><span class="main">.</span> <span class="free">bs</span> <span class="main">@</span> <span class="bound">bs'</span> <span class="main">=</span> b <span class="main">#</span> a <span class="main">#</span> <span class="bound">bs''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> active_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> comp_q1_dest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> active_q2_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"active q2 <span class="free">bs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bs'</span> <span class="bound">bs''</span><span class="main">.</span> <span class="free">bs</span> <span class="main">@</span> <span class="bound">bs'</span> <span class="main">=</span> a <span class="main">#</span> b <span class="main">#</span> <span class="bound">bs''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> active_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> comp_q2_dest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> active_q3_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"active q3 <span class="free">bs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bs'</span> <span class="bound">bs''</span><span class="main">.</span> <span class="free">bs</span> <span class="main">@</span> <span class="bound">bs'</span> <span class="main">=</span> a <span class="main">#</span> a <span class="main">#</span> <span class="bound">bs''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> active_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> comp_q3_dest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_q0_dest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">y</span> <span class="main">#</span> <span class="free">zs</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span> <span class="bound">v''</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">v'</span> <span class="main">@</span> <span class="bound">v''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">∧</span> computation q0 <span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="bound">v''</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> computation.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> comp_q1_dest comp_q2_dest comp_q3_dest<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> bt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span> <span class="main">@</span> <span class="free">v'</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"active <span class="free">q</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="free">q'</span>"</span></span> <span class="quoted"><span class="quoted">"active <span class="free">q'</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v'</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct_list012<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">w''</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">@</span> <span class="skolem">w''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">w'</span><span class="main">)</span> <span class="main">∈</span> T"</span></span> <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="skolem">zs</span><span class="main">,</span> <span class="skolem">w''</span><span class="main">)</span> <span class="free">q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_q0_dest<span class="main">[</span><span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="skolem"><span class="skolem">z''</span></span> <span class="keyword2"><span class="keyword">where</span></span> vv'_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">@</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">z'</span> <span class="main">@</span> <span class="skolem">z''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">∈</span> T"</span></span>
    <span class="quoted"><span class="quoted">"computation q0 <span class="main">(</span><span class="skolem">zs</span><span class="main">,</span> <span class="skolem">z''</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_q0_dest<span class="main">[</span><span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="skolem">z'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> z''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z''</span> <span class="main">=</span> <span class="skolem">w''</span> <span class="main">@</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vv'_split<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> v_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> True<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> vv'_split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> z''_def<span class="main"><span class="main">]</span></span> 3<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> v_split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 3<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span> <span class="main">∧</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="skolem">w'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span> <span class="main">∧</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> v_split<span class="main">(</span>2<span class="main">)</span> vv'_split<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span> <span class="main">∧</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w''</span> <span class="main">@</span> <span class="skolem">v'</span> <span class="main">=</span> b <span class="main">#</span> <span class="skolem">z''</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vv'_split<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> v_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v'</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> computation.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> v_split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> z''_def no_step<span class="main">[</span><span class="operator">OF</span> vv'_split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span> <span class="main">∧</span> <span class="skolem">z'</span> <span class="main">=</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z''</span> <span class="main">=</span> b <span class="main">#</span> <span class="skolem">w''</span> <span class="main">@</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vv'_split<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> v_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v'</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> computation.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vv'_split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> z''_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> computation.cases delta.cases<span class="main">)</span>

<span class="comment1">(* NFT has bounded trailing *)</span>

<span class="keyword1"><span class="command">interpretation</span></span> bNFT <span class="quoted">q0</span> <span class="quoted">delta</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">=</span> q0"</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_def bt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tdfa_init<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_init <span class="main">=</span> STATE <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_q0_qf
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tdfa_init_def active_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delta_length<span class="main">:</span> <span class="quoted"><span class="quoted">"delta <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> length <span class="main">(</span>snd <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> delta_length'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> delta <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">∧</span> length <span class="main">(</span>snd <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> delta.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> output_speed<span class="main">:</span> <span class="quoted"><span class="quoted">"output_speed <span class="main">=</span> <span class="numeral">4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">`</span> snd <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> delta <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> delta_length delta_length'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> imageI mem_Collect_eq snd_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> output_speed_def all_trans_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> K'<span class="main">:</span> <span class="quoted"><span class="quoted">"t' <span class="main">=</span> <span class="numeral">5</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> t'_def output_speed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Figure 2b *)</span>

<span class="keyword1"><span class="command">lemma</span></span> step_1<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step tdfa_init <span class="main">(</span>Symb a<span class="main">,</span> Symb a<span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"ext_qs a <span class="main">[]</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs_def active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="main">0</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step tdfa_init <span class="main">(</span>Symb a<span class="main">,</span> Symb a<span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> init_in_tdfa_Q<span class="main">[</span><span class="operator">unfolded</span> tdfa_init<span class="main">]</span> ext_qs<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps tdfa_init K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> init_in_tdfa_Q<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> tdfa_init<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tdfa_init<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_2<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"ext_qs b <span class="main">[</span>a<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs_def active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="main">0</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_1<span class="main">(</span>2<span class="main">)</span> ext_qs<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_3<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb a<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"ext_qs a <span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs_def active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="main">0</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb a<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_2<span class="main">(</span>2<span class="main">)</span> ext_qs<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_4<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"ext_qs b <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs_def active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="main">0</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_3<span class="main">(</span>2<span class="main">)</span> ext_qs<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_5<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb a<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"ext_qs a <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs_def active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="main">0</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb a<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_4<span class="main">(</span>2<span class="main">)</span> ext_qs<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_4<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> take <span class="free">n</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">⟹</span>
  <span class="free">n</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> step_6<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> True<span class="main">,</span> False<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> act_q1<span class="main">:</span> <span class="quoted"><span class="quoted">"active q1 <span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_step<span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> act_q2<span class="main">:</span> <span class="quoted"><span class="quoted">"active q2 <span class="main">[</span>a<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_step<span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> act_q3<span class="main">:</span> <span class="quoted"><span class="quoted">"active q3 <span class="main">[</span>a<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_step<span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> upd_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"upd_qs a <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upd_qs_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> active_q1_dest active_q2_dest active_q3_dest take_length
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> delta.intros act_q1 act_q2 act_q3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="numeral">3</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> True<span class="main">,</span> False<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_5<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upd_qs drop_qs Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_5<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_7<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"ext_qs b <span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_step<span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> one_step<span class="main">[</span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs_def active_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> comp_q3_dest<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="main">0</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q3<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Symb b<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_6<span class="main">(</span>2<span class="main">)</span> drop_qs
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps ext_qs K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ext_qs Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_6<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_8<span class="main">:</span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Blank<span class="main">)</span> <span class="main">=</span>
  Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> True<span class="main">,</span> False<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> act_qf<span class="main">:</span> <span class="quoted"><span class="quoted">"active q0 <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> active_q0_b_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">zs</span><span class="main">.</span> active q0 <span class="main">(</span>b <span class="main">#</span> <span class="bound">zs</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> active_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> computation.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> upd_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"upd_qs a <span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> active_q0_b_dest
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upd_qs_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> delta.intros act_qf<span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> One_nat_def diff_self_eq_0 drop0 drop_Suc_Cons le_SucE le_zero_eq
        list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> numeral_3_eq_3 take_Cons'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> drop_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"drop_qs <span class="numeral">3</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tdfa_step <span class="main">(</span>STATE <span class="main">(</span><span class="main">[</span>b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q1<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>q2<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Symb a<span class="main">,</span> Blank<span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span>STATE <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> True<span class="main">,</span> False<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step_7<span class="main">(</span>2<span class="main">)</span> upd_qs
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa_step.simps K'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_qs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"STATE <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> tdfa_Q"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tdfa_closed<span class="main">[</span><span class="operator">OF</span> step_7<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> tdfa<span class="main">:</span> TDFA <span class="quoted">tdfa_init</span> <span class="quoted">tdfa_step</span> <span class="quoted">tdfa_accept</span> <span class="quoted">tdfa_Q</span>
  <span class="keyword1"><span class="command">using</span></span> tdfa_axioms <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> tdfa.τ"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tdfa.computation tdfa_init <span class="main">(</span><span class="main">(</span><span class="main">[</span>a<span class="main">,</span> a<span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span>a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">,</span> a<span class="main">,</span> b<span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>STATE <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>q0<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> tdfa.computation.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> step_1<span class="main">(</span>1<span class="main">)</span> step_2<span class="main">(</span>1<span class="main">)</span> step_3<span class="main">(</span>1<span class="main">)</span> step_4<span class="main">(</span>1<span class="main">)</span> step_5<span class="main">(</span>1<span class="main">)</span> step_6<span class="main">(</span>1<span class="main">)</span> step_7<span class="main">(</span>1<span class="main">)</span> step_8<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> safe_hd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tdfa.τ_def tdfa_accept_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>