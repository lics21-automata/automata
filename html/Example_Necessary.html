<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Example_Necessary</title>
</head>


<body>
<div class="head">
<h1>Theory Example_Necessary</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Example_Necessary
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Computation.html">Computation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Example 17 *)</span>

<span class="keyword1"><span class="command">datatype</span></span> states <span class="main">=</span> Init <span class="main">|</span> Copy <span class="quoted">bool</span> <span class="main">|</span> Skip <span class="quoted">bool</span> <span class="main">|</span> Check <span class="quoted">bool</span> <span class="main">|</span> Accept

<span class="keyword1"><span class="command">instantiation</span></span> states <span class="main">::</span> <span class="quoted">finite</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> states set<span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>Init<span class="main">,</span> Copy True<span class="main">,</span> Copy False<span class="main">,</span> Skip True<span class="main">,</span> Skip False<span class="main">,</span>
    Check True<span class="main">,</span> Check False<span class="main">,</span> Accept<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> states.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> states set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> Sigma <span class="main">=</span> <span class="quoted"><span class="quoted">"bool"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"states <span class="main">⇒</span> Sigma <span class="main">⇒</span> states <span class="main">×</span> Sigma list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delta</span> Init False <span class="main">(</span>Copy False<span class="main">,</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> Init False <span class="main">(</span>Skip True<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> Init True <span class="main">(</span>Skip False<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> Init True <span class="main">(</span>Copy True<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Copy False<span class="main">)</span> True <span class="main">(</span>Skip False<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Skip True<span class="main">)</span> True <span class="main">(</span>Copy True<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Copy <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> False <span class="main">(</span>Copy <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> False <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Skip False<span class="main">)</span> True <span class="main">(</span>Check False<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Copy True<span class="main">)</span> True <span class="main">(</span>Check True<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Check False<span class="main">)</span> False <span class="main">(</span>Accept<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">(</span>Check True<span class="main">)</span> True <span class="main">(</span>Accept<span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> delta <span class="free">q</span> <span class="free">z</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> delta <span class="free">q</span> <span class="free">z</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> UNIV <span class="main">×</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset finite_bounded_lists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> NFT <span class="quoted">Init</span> <span class="quoted">delta</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">=</span> Accept"</span></span> <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">using</span></span> finite_UNIV finite_delta
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Accept<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">=</span> Accept <span class="main">⟹</span>
  <span class="free">q'</span> <span class="main">=</span> Accept <span class="main">∧</span> <span class="free">as</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Check_Accept<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">=</span> Check <span class="free">b</span> <span class="main">⟹</span>
  <span class="free">q'</span> <span class="main">=</span> Check <span class="free">b</span> <span class="main">∨</span> <span class="free">q'</span> <span class="main">=</span> Accept"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nft_comp_Accept<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Copy_True_Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span>
  <span class="free">q</span> <span class="main">=</span> Copy True <span class="main">⟹</span> <span class="free">q'</span> <span class="main">=</span> Skip <span class="free">b</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nft_comp_Check_Accept<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Skip_False_Copy<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span>
  <span class="free">q</span> <span class="main">=</span> Skip False <span class="main">⟹</span> <span class="free">q'</span> <span class="main">=</span> Copy <span class="free">b</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nft_comp_Check_Accept<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Skip_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">=</span> Skip <span class="free">b</span> <span class="main">⟹</span> <span class="free">q'</span> <span class="main">=</span> Skip <span class="free">b'</span> <span class="main">⟹</span>
  <span class="free">as</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> False <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nft_comp_Copy_True_Skip nft_comp_Check_Accept<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Copy_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">=</span> Copy <span class="free">b</span> <span class="main">⟹</span> <span class="free">q'</span> <span class="main">=</span> Copy <span class="free">b'</span> <span class="main">⟹</span>
  <span class="free">as</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> False <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nft_comp_Skip_False_Copy nft_comp_Check_Accept<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Skip_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="main">(</span>Skip <span class="free">b</span><span class="main">)</span> <span class="main">(</span>replicate <span class="free">n</span> False<span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Skip <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> computation.step delta.intros<span class="main">(</span>8<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nft_comp_Copy_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"computation <span class="main">(</span>Copy <span class="free">b</span><span class="main">)</span> <span class="main">(</span>replicate <span class="free">n</span> False<span class="main">,</span> replicate <span class="free">n</span> False<span class="main">)</span> <span class="main">(</span>Copy <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> computation.step delta.intros<span class="main">(</span>7<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sound_True<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>replicate <span class="free">n</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> replicate <span class="free">n'</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">,</span>
  replicate <span class="free">n</span> False<span class="main">)</span> <span class="main">∈</span> τ"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> τ_def
  <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nft_comp_Skip_intro<span class="main"><span class="main">]</span></span> 
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        comp_trans<span class="main">[</span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nft_comp_Copy_intro<span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> nft_comp_Skip_intro<span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sound_False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>replicate <span class="free">n</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> replicate <span class="free">n'</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">,</span>
  replicate <span class="free">n'</span> False<span class="main">)</span> <span class="main">∈</span> τ"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> τ_def
  <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nft_comp_Copy_intro<span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        comp_trans<span class="main">[</span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nft_comp_Skip_intro<span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> nft_comp_Copy_intro<span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_part<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Skip False <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> Copy True"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">q'</span> <span class="main">=</span> Skip False <span class="main">∨</span> <span class="free">q'</span> <span class="main">=</span> Copy True"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">q'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> False <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> Copy True <span class="keyword1">then</span> <span class="free">as</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> q_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nft_comp_Copy_True_Skip<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> nft_comp_Skip_False_Copy<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> False <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> Copy True <span class="keyword1">then</span> <span class="free">as</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Copy True"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> False <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> Copy True <span class="keyword1">then</span> <span class="free">as</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nft_comp_Copy_dest<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> q_def q_q'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> q_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Skip False"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> False <span class="main">∧</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> Copy True <span class="keyword1">then</span> <span class="free">as</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nft_comp_Skip_dest<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> q_def q_q'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> q_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_part<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="free">q'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Copy False <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> Skip True"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">q'</span> <span class="main">=</span> Skip False <span class="main">∨</span> <span class="free">q'</span> <span class="main">=</span> Copy True"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">n'</span><span class="main">.</span> <span class="free">as</span> <span class="main">=</span> replicate <span class="bound">n</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> replicate <span class="bound">n'</span> False <span class="main">∧</span>
    <span class="free">bs</span> <span class="main">=</span> replicate <span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> Copy False <span class="keyword1">then</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="bound">n'</span><span class="main">)</span> False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> computation.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">q</span> <span class="skolem">a</span> <span class="skolem">q'</span> <span class="skolem">bs</span> <span class="skolem">as</span> <span class="skolem">bs'</span> <span class="skolem">q''</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step nft_comp_Copy_dest nft_comp_Skip_dest
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n n'
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n n'
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n n'
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n n'
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step
      <span class="keyword1"><span class="command">using</span></span> snd_part<span class="main">[</span><span class="operator">OF</span> step<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_end_Accept<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> Accept"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Accept"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as'</span> <span class="bound">β</span><span class="main">.</span> computation <span class="free">q</span> <span class="main">(</span><span class="bound">as'</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>Check <span class="bound">β</span><span class="main">)</span> <span class="main">∧</span> <span class="free">as</span> <span class="main">=</span> <span class="bound">as'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">β</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted">Accept</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> comp_rev_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_end_Check<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"computation <span class="free">q</span> <span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>Check <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> Check <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as'</span><span class="main">.</span> computation <span class="free">q</span> <span class="main">(</span><span class="bound">as'</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> Copy True <span class="keyword1">else</span> Skip False<span class="main">)</span> <span class="main">∧</span> <span class="free">as</span> <span class="main">=</span> <span class="bound">as'</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="quoted">"Check <span class="free">b</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> comp_rev_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="main">∈</span> τ"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">β</span><span class="main">.</span> <span class="free">as</span> <span class="main">=</span> replicate <span class="bound">n</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> replicate <span class="bound">n'</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="bound">β</span><span class="main">]</span> <span class="main">∧</span>
    <span class="free">bs</span> <span class="main">=</span> replicate <span class="main">(</span><span class="keyword1">if</span> <span class="bound">β</span> <span class="keyword1">then</span> <span class="bound">n'</span> <span class="keyword1">else</span> <span class="bound">n</span><span class="main">)</span> False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"computation Init <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as'</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> Accept"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> τ_def Cons
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="skolem"><span class="skolem">cs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"delta Init <span class="skolem">a</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">cs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"computation <span class="skolem">q</span> <span class="main">(</span><span class="skolem">as'</span><span class="main">,</span> <span class="skolem">cs'</span><span class="main">)</span> Accept"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">cs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> computation.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Copy False <span class="main">∨</span> <span class="skolem">q</span> <span class="main">=</span> Skip True"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">q</span> <span class="main">=</span> Copy False <span class="keyword1">then</span> <span class="main">[</span>False<span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as''</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="skolem">as''</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">β</span><span class="main">]</span>"</span></span>
      <span class="quoted"><span class="quoted">"computation <span class="skolem">q</span> <span class="main">(</span><span class="skolem">as''</span><span class="main">,</span> <span class="skolem">cs'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">β</span> <span class="keyword1">then</span> Copy True <span class="keyword1">else</span> Skip False<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_end_Accept<span class="main">[</span><span class="operator">OF</span> split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> comp_end_Check q_or
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> wit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as''</span> <span class="main">=</span> replicate <span class="skolem">n</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> replicate <span class="skolem">n'</span> False"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">cs'</span> <span class="main">=</span> replicate <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">q</span> <span class="main">=</span> Copy False <span class="keyword1">then</span> <span class="skolem">n</span> <span class="keyword1">else</span> <span class="skolem">n'</span><span class="main">)</span> False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fst_part<span class="main">[</span><span class="operator">OF</span> tail<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> q_or<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> β_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">⟷</span> <span class="skolem">q</span> <span class="main">=</span> Skip True"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tail<span class="main">(</span>2<span class="main">)</span> q_or
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nft_comp_Copy_dest nft_comp_Skip_dest<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons False tail<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cs_def wit β_iff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> q_or
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Skip False <span class="main">∨</span> <span class="skolem">q</span> <span class="main">=</span> Copy True"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> split<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> delta.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as''</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as'</span> <span class="main">=</span> <span class="skolem">as''</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">β</span><span class="main">]</span>"</span></span>
      <span class="quoted"><span class="quoted">"computation <span class="skolem">q</span> <span class="main">(</span><span class="skolem">as''</span><span class="main">,</span> <span class="skolem">cs'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">β</span> <span class="keyword1">then</span> Copy True <span class="keyword1">else</span> Skip False<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_end_Accept<span class="main">[</span><span class="operator">OF</span> split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> comp_end_Check q_or
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> length <span class="skolem">as''</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> wit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as''</span> <span class="main">=</span> replicate <span class="skolem">n</span> False"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">cs'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">q</span> <span class="main">=</span> Copy True <span class="keyword1">then</span> <span class="skolem">as''</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">β</span> <span class="keyword1">then</span> Copy True <span class="keyword1">else</span> Skip False<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snd_part<span class="main">[</span><span class="operator">OF</span> tail<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> q_or<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> wit<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons True tail<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wit<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> split<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> τ_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_step<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> active_Copy<span class="main">:</span> <span class="quoted"><span class="quoted">"active <span class="main">(</span>Copy False<span class="main">)</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> active_Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"active <span class="main">(</span>Skip True<span class="main">)</span> <span class="main">(</span>replicate <span class="free">n</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>
        nft_comp_Copy_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">True</span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
        one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> active_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> correctness<span class="main">:</span> <span class="quoted"><span class="quoted">"τ <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">as</span><span class="main">,</span> <span class="bound">bs</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">β</span><span class="main">.</span> <span class="bound">as</span> <span class="main">=</span> replicate <span class="bound">n</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span>
  replicate <span class="bound">n'</span> False <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="bound">β</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">bs</span> <span class="main">=</span> replicate <span class="main">(</span><span class="keyword1">if</span> <span class="bound">β</span> <span class="keyword1">then</span> <span class="bound">n'</span> <span class="keyword1">else</span> <span class="bound">n</span><span class="main">)</span> False<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sound_True sound_False completeness
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> unbounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>bounded <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bounded_def
  <span class="keyword1"><span class="command">using</span></span> comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nft_comp_Copy_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">False</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        active_Copy
        comp_trans<span class="main">[</span><span class="operator">OF</span> one_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nft_comp_Skip_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">True</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        active_Skip<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> impossible_Cons
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>